(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&e(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();class a{constructor(t){this.url="http://127.0.0.1:3000/api/v1/routes",this.tableBody=t}async loadTable(){const t=await this.getRoutes();if(t.length===0){const e=document.createElement("tr");e.insertCell(0).innerHTML="No routes found",this.tableBody.innerHTML="",this.tableBody.appendChild(e);return}const r=document.createDocumentFragment();t.forEach((e,n)=>{const o=document.createElement("tr");o.insertCell(0).innerHTML=String(n+1),o.insertCell(1).innerHTML=e.destination,o.insertCell(2).innerHTML=e.gateway,o.insertCell(3).innerHTML=e.flags,o.insertCell(4).innerHTML=e.netif,o.insertCell(5).appendChild(this.createStatusSwitch(e)),o.insertCell(6).appendChild(this.createDeleteButton(e)),r.appendChild(o)}),this.tableBody.innerHTML="",this.tableBody.appendChild(r)}createStatusSwitch(t){const r=document.createElement("div");r.setAttribute("class","form-check form-switch");const e=document.createElement("input");return e.setAttribute("type","checkbox"),e.setAttribute("class","form-check-input"),e.setAttribute("role","switch"),e.checked=t.expire!==null,r.appendChild(e),e.addEventListener("change",()=>this.switchStatus(t,e.checked)),r}createDeleteButton(t){const r=document.createElement("button");r.setAttribute("type","button"),r.setAttribute("class","btn btn-sm btn-danger");const e=document.createElement("span");e.setAttribute("class","spinner-border spinner-border-sm"),e.setAttribute("role","status"),e.setAttribute("aria-hidden","true"),e.style.display="none";const n=document.createElement("i");return n.setAttribute("class","bi bi-trash"),r.appendChild(n),r.appendChild(e),r.addEventListener("click",async()=>{r.disabled=!0,e.style.display="inline-block",n.style.display="none",await this.deleteRoute(t)}),r}async getRoutes(){try{return(await(await fetch(this.url)).json()).data}catch(t){return console.error(t),[]}}async switchStatus(t,r){const e=r?"enabled":"disabled";console.log(`Switch status for route ${t.destination} into ${e}`);try{if((await fetch(`${this.url}?destination=${encodeURIComponent(t.destination)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:r})})).status!==204)throw new Error(`Failed to switch status for route ${t.destination}`)}catch(n){console.error(n)}}async deleteRoute(t){console.log(`Delete route ${t.destination}`);try{if((await fetch(`${this.url}?destination=${encodeURIComponent(t.destination)}`,{method:"DELETE"})).status!==204)throw new Error(`Failed to delete route ${t.destination}`);await this.loadTable()}catch(r){console.error(r)}}}document.addEventListener("DOMContentLoaded",async function(){const s=document.getElementById("data-rows");if(!s)throw new Error("Could not find the table body");await new a(s).loadTable()});
