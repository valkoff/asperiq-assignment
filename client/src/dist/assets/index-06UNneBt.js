(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();class a{constructor(e){this.url="http://127.0.0.1:3000/api/v1/routes",this.tableBody=e}async loadTable(){const e=await this.getRoutes();if(e.length===0){const t=document.createElement("tr");t.insertCell(0).innerHTML="No routes found",this.tableBody.innerHTML="",this.tableBody.appendChild(t);return}const r=document.createDocumentFragment();e.forEach((t,n)=>{const o=document.createElement("tr");o.insertCell(0).innerHTML=String(n+1),o.insertCell(1).innerHTML=t.destination,o.insertCell(2).innerHTML=t.gateway,o.insertCell(3).innerHTML=t.flags,o.insertCell(4).innerHTML=t.netif,o.insertCell(5).appendChild(this.createStatusSwitch(t)),o.insertCell(6).appendChild(this.createDeleteButton(t)),r.appendChild(o)}),this.tableBody.innerHTML="",this.tableBody.appendChild(r)}createStatusSwitch(e){const r=document.createElement("div");r.setAttribute("class","form-check form-switch");const t=document.createElement("input");return t.setAttribute("type","checkbox"),t.setAttribute("class","form-check-input"),t.setAttribute("role","switch"),t.checked=e.expire!==null,r.appendChild(t),t.addEventListener("change",()=>this.switchStatus(e,t.checked)),r}createDeleteButton(e){const r=document.createElement("button");return r.setAttribute("type","button"),r.setAttribute("class","btn btn-sm btn-danger"),r.innerHTML='<i class="bi bi-trash"></i>',r.addEventListener("click",()=>this.deleteRoute(e)),r}async getRoutes(){try{return(await(await fetch(this.url)).json()).data}catch(e){return console.error(e),[]}}async switchStatus(e,r){const t=r?"enabled":"disabled";console.log(`Switch status for route ${e.destination} into ${t}`);try{if((await fetch(`${this.url}/${e.destination}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:r})})).status!==204)throw new Error(`Failed to switch status for route ${e.destination}`)}catch(n){console.error(n)}}async deleteRoute(e){console.log(`Delete route ${e.destination}`);try{if((await fetch(`${this.url}/${e.destination}`,{method:"DELETE"})).status!==204)throw new Error(`Failed to delete route ${e.destination}`);await this.loadTable()}catch(r){console.error(r)}}}document.addEventListener("DOMContentLoaded",async function(){const s=document.getElementById("data-rows");if(!s)throw new Error("Could not find the table body");await new a(s).loadTable()});
